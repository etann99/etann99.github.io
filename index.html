<!DOCTYPE html>
<html lang="mg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rediredin'i Nantenaina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body { 
            height: 100%; 
            margin: 0; 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8b5fbf 75%, #a855f7 100%);
            background-attachment: fixed;
            color: #2d3748;
            overflow-x: hidden;
        }

        /* Animated Stars Background */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 3s infinite;
        }

        .star:nth-child(odd) {
            animation-delay: 1s;
        }

        .star:nth-child(3n) {
            animation-delay: 2s;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1); }
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px white, 0 0 20px white;
            animation: shoot 4s linear infinite;
            opacity: 0;
        }

        @keyframes shoot {
            0% { opacity: 0; transform: translateX(-100px) translateY(100px); }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; transform: translateX(300px) translateY(-300px); }
        }

        /* Glassmorphism Effects */
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .glass-dark {
            background: linear-gradient(135deg, rgba(0,0,0,0.85) 0%, rgba(26,26,46,0.85) 30%, rgba(22,33,62,0.85) 70%, rgba(15,52,96,0.85) 100%);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            color: #f8fafc;
        }

        /* Header Styling */
        header {
            position: relative;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .header-title {
            font-family: 'Playfair Display', serif;
            color: #f1f5f9;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(255, 255, 255, 0.3);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2));
        }

        /* Navigation */
        nav a {
            position: relative;
            transition: all 0.3s ease;
            color: #e2e8f0;
            text-decoration: none;
        }

        nav a:hover {
            color: #f8fafc;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(139, 92, 246, 0.5);
        }

        nav a:hover::after {
            width: 100%;
        }

        /* Select Styling */
        .lang-select {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 8px 16px;
            color: #e2e8f0;
            transition: all 0.3s ease;
        }

        .lang-select:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Main Content */
        main {
            position: relative;
            z-index: 10;
            min-height: calc(100vh - 200px);
        }

        /* Article Cards */
        .article-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-radius: 24px;
        }

        .article-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .article-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .article-card:hover::before {
            opacity: 0.1;
        }

        .article-image {
            transition: transform 0.4s ease;
            border-radius: 16px;
            overflow: hidden;
        }

        .article-card:hover .article-image {
            transform: scale(1.05);
        }

        /* Proverb Styling */
        .proverb {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            color: #f8fafc;
            font-weight: 500;
            font-size: 1.25rem;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.2));
        }

        .proverb::before,
        .proverb::after {
            content: '"';
            font-size: 2rem;
            opacity: 0.4;
            position: absolute;
            color: #e2e8f0;
        }

        .proverb::before {
            left: -20px;
            top: -5px;
        }

        .proverb::after {
            right: -20px;
            bottom: -5px;
        }

        /* Buttons */
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-gradient:hover::before {
            left: 100%;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Links */
        .link-gradient {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .link-gradient:hover {
            transform: translateX(4px);
        }

        /* Admin form styles */
        #admin-form {
            display: none;
        }

        #admin-form.active {
            display: block;
        }

        .form-input {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            width: 100%;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        /* Footer */
        footer {
            position: relative;
            z-index: 10;
            margin-top: 4rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .article-card:hover {
                transform: translateY(-6px) scale(1.01);
            }
            
            .proverb::before,
            .proverb::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Stars Background -->
    <div class="stars-container" id="stars-container"></div>

    <header class="glass-dark">
        <div class="container mx-auto px-6 py-8">
            <h1 class="header-title text-5xl font-bold mb-4" data-lang-mg="Rediredin'i Nantenaina" data-lang-fr="Divagations de Nantenaina" data-lang-en="Nantenaina's Wanderings">Rediredin'i Nantenaina</h1>
            <p class="text-slate-200 text-lg font-light mb-6" data-lang-mg="Eritreritra na fihetseham-po sendra nandalo, dia nantsoina mba hitafa, dia noraketina an-tsoratra." data-lang-fr="Pensées ou émotions passantes, appelées à dialoguer, puis écrites." data-lang-en="Passing thoughts or emotions, called to converse, then written down.">Eritreritra na fihetseham-po sendra nandalo, dia nantsoina mba hitafa, dia noraketina an-tsoratra.</p>
            <nav class="flex flex-col md:flex-row justify-between items-center gap-6">
                <ul class="flex flex-wrap justify-center gap-8">
                    <li><a href="#" class="hover:text-blue-300 transition-colors" data-lang-mg="Fandraisana" data-lang-fr="Accueil" data-lang-en="Home">Fandraisana</a></li>
                    <li><a href="#" class="hover:text-blue-300 transition-colors" data-lang-mg="Momba Ahy" data-lang-fr="À propos" data-lang-en="About">Momba Ahy</a></li>
                    <li><a href="#" class="hover:text-blue-300 transition-colors" data-lang-mg="Hifandray" data-lang-fr="Contact" data-lang-en="Contact">Hifandray</a></li>
                </ul>
                <select id="lang-switcher" class="lang-select" onchange="switchLanguage()">
                    <option value="mg">🇲🇬 Malagasy</option>
                    <option value="fr">🇫🇷 Français</option>
                    <option value="en">🇺🇸 English</option>
                </select>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section class="mb-16">
            <div class="proverb">"Ny fanahy no olona" – Ohabolana Malagasy</div>
            
            <div class="mb-12">
                <h2 class="text-4xl font-bold text-white mb-4" data-lang-mg="Lahatsoratra Rehetra" data-lang-fr="Tous les articles" data-lang-en="All Articles">Lahatsoratra Rehetra</h2>
                <div class="w-24 h-1 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full"></div>
            </div>

            <div id="admin-form" class="glass rounded-3xl p-8 mb-12 shadow-2xl">
                <h3 class="text-2xl font-bold mb-6 text-center" id="form-title">Add New Article</h3>
                <input type="hidden" id="edit-id">
                <input type="password" id="admin-password" class="form-input" placeholder="Admin Password" required>
                <input type="text" id="article-title" class="form-input" placeholder="Article Title" required>
                <textarea id="article-content" class="form-input" placeholder="Article Content" rows="6" required></textarea>
                <input type="date" id="article-date" class="form-input" required>
                <input type="text" id="article-tags" class="form-input" placeholder="Tags (e.g., Fitiavana, Kolontsaina)">
                <input type="url" id="article-image" class="form-input" placeholder="Image URL">
                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="saveArticle()" class="btn-gradient flex-1">Submit Article</button>
                    <button onclick="exportArticles()" class="btn-gradient" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">Export Articles</button>
                </div>
            </div>

            <div id="article-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                <!-- Articles will be loaded here -->
            </div>
        </section>
    </main>

    <footer class="glass-dark mt-16">
        <div class="container mx-auto px-6 py-8 text-center">
            <p class="text-gray-200 mb-4" data-lang-mg="© 2025 Nantenaina Ratsimbazafy. Zo rehetra voatokana." data-lang-fr="© 2025 Nantenaina Ratsimbazafy. Tous droits réservés." data-lang-en="© 2025 Nantenaina Ratsimbazafy. All rights reserved.">© 2025 Nantenaina Ratsimbazafy. Zo rehetra voatokana.</p>
        </div>
    </footer>

    <script>
        // Admin password
        const adminPassword = 'nantenaina2025';

        // Basic HTML sanitizer
        function sanitizeHTML(str) {
            if (typeof str !== 'string') return '';
            return str.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        }

        // Create animated stars
        function createStars() {
            const container = document.getElementById('stars-container');
            const numberOfStars = 100;
            
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                container.appendChild(star);
            }

            for (let i = 0; i < 5; i++) {
                const shootingStar = document.createElement('div');
                shootingStar.className = 'shooting-star';
                shootingStar.style.left = Math.random() * 100 + '%';
                shootingStar.style.top = Math.random() * 50 + '%';
                shootingStar.style.animationDelay = Math.random() * 10 + 's';
                shootingStar.style.animationDuration = (Math.random() * 2 + 3) + 's';
                container.appendChild(shootingStar);
            }
        }

        function switchLanguage() {
            try {
                const lang = document.getElementById('lang-switcher').value;
                try {
                    localStorage.setItem('selectedLanguage', lang);
                } catch(e) {
                    console.warn('localStorage not available');
                }
                document.querySelectorAll('[data-lang-mg]').forEach(el => {
                    el.textContent = el.getAttribute(`data-lang-${lang}`);
                });
                loadArticles();
            } catch (error) {
                console.error('Error switching language:', error);
                alert('Failed to switch language. Check console for details.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                createStars();
                
                const savedLang = (typeof Storage !== "undefined" && localStorage.getItem('selectedLanguage')) || 'mg';
                document.getElementById('lang-switcher').value = savedLang;
                document.querySelectorAll('[data-lang-mg]').forEach(el => {
                    el.textContent = el.getAttribute(`data-lang-${savedLang}`);
                });

                // Show admin form if ?admin=true
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('admin') === 'true') {
                    const adminForm = document.getElementById('admin-form');
                    if (adminForm) adminForm.classList.add('active');
                }

                // Check for unsaved changes in localStorage
                checkUnsavedChanges();

                // Load articles
                loadArticles();
            } catch (error) {
                console.error('Error initializing page:', error);
                alert('Failed to initialize page. Check console for details.');
            }
        });

        async function fetchArticles() {
            try {
                const response = await fetch('articles.json');
                if (!response.ok) {
                    if (response.status === 404) {
                        console.warn('articles.json not found, returning empty array');
                        return [];
                    }
                    throw new Error(`Failed to fetch articles: ${response.statusText} (Status: ${response.status})`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching articles:', error);
                alert('Failed to load articles from articles.json. Check console for details.');
                return [];
            }
        }

        function exportArticles() {
            try {
                const articles = JSON.parse(localStorage.getItem('articles') || '[]');
                const jsonStr = JSON.stringify(articles, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'articles.json';
                a.click();
                URL.revokeObjectURL(url);
                alert('Downloaded articles.json. Upload it to your GitHub repository (Etann99/Etann99.github.io) at articles.json to make changes visible to all.');
            } catch (error) {
                console.error('Error exporting articles:', error);
                alert(`Failed to export articles: ${error.message}. Check console for details.`);
            }
        }

        async function checkUnsavedChanges() {
            try {
                const isAdmin = new URLSearchParams(window.location.search).get('admin') === 'true';
                if (!isAdmin) return;

                const articles = await fetchArticles();
                let localArticles;
                try {
                    localArticles = JSON.parse(localStorage.getItem('articles') || '[]');
                } catch (e) {
                    console.error('Error parsing localStorage articles:', e);
                    localArticles = [];
                }

                const articlesStr = JSON.stringify(articles);
                const localArticlesStr = JSON.stringify(localArticles);
                if (localArticles.length > 0 && articlesStr !== localArticlesStr) {
                    alert('You have unsaved changes in local storage. Click "Export Articles" and upload to GitHub to save them permanently.');
                }
            } catch (error) {
                console.error('Error checking unsaved changes:', error);
            }
        }

        function saveArticle() {
            try {
                console.log('saveArticle called');
                const passwordInput = document.getElementById('admin-password');
                const titleInput = document.getElementById('article-title');
                const contentInput = document.getElementById('article-content');
                const dateInput = document.getElementById('article-date');
                const tagsInput = document.getElementById('article-tags');
                const imageInput = document.getElementById('article-image');
                const editIdInput = document.getElementById('edit-id');

                if (!passwordInput || !titleInput || !contentInput || !dateInput || !tagsInput || !imageInput || !editIdInput) {
                    throw new Error('One or more form elements are missing.');
                }

                const password = passwordInput.value;
                if (!password) {
                    alert('Please enter a password.');
                    return;
                }
                if (password !== adminPassword) {
                    alert('Incorrect password.');
                    return;
                }

                const id = editIdInput.value ? parseInt(editIdInput.value) : null;
                const title = sanitizeHTML(titleInput.value);
                const content = contentInput.value;
                const date = dateInput.value;
                const tags = tagsInput.value.split(',').map(tag => sanitizeHTML(tag.trim())).filter(tag => tag);
                const image = imageInput.value || 'https://mta.mg/wp-content/uploads/2021/05/Sunset-baobabs-Madagascar-mta-1.jpg';

                if (!title || !content || !date) {
                    alert('Please fill in title, content, and date.');
                    return;
                }

                let articles;
                try {
                    articles = JSON.parse(localStorage.getItem('articles') || '[]');
                } catch (e) {
                    console.error('Error parsing localStorage articles:', e);
                    articles = [];
                }

                if (id) {
                    const articleIndex = articles.findIndex(article => article.id === id);
                    if (articleIndex === -1) {
                        alert('Article to modify not found in local storage.');
                        return;
                    }
                    articles[articleIndex] = { id, title, content, date, tags, image };
                } else {
                    const newId = articles.length ? Math.max(...articles.map(a => a.id)) + 1 : 1;
                    articles.push({ id: newId, title, content, date, tags, image });
                }

                try {
                    localStorage.setItem('articles', JSON.stringify(articles));
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    alert('Failed to save to local storage. Try clearing browser data or using another browser.');
                    return;
                }

                document.getElementById('form-title').textContent = 'Add New Article';
                editIdInput.value = '';
                passwordInput.value = '';
                titleInput.value = '';
                contentInput.value = '';
                dateInput.value = '';
                tagsInput.value = '';
                imageInput.value = '';

                alert('Article saved locally. Click "Export Articles" to download articles.json, then upload to GitHub to make it visible to all.');
                loadArticles();
            } catch (error) {
                console.error('Error in saveArticle:', error);
                alert(`Failed to save article: ${error.message}. Check console for details.`);
            }
        }

        function modifyArticle(id) {
            try {
                console.log('modifyArticle called with id:', id);
                const password = prompt('Enter admin password to modify article:');
                if (!password) {
                    alert('Please enter a password.');
                    return;
                }
                if (password !== adminPassword) {
                    alert('Incorrect password.');
                    return;
                }

                // Load articles.json for modification
                fetchArticles().then(articles => {
                    const article = articles.find(a => a.id === id);
                    if (!article) {
                        alert('Article not found in articles.json. Ensure it exists in the GitHub repository.');
                        return;
                    }

                    const formTitle = document.getElementById('form-title');
                    const editIdInput = document.getElementById('edit-id');
                    const titleInput = document.getElementById('article-title');
                    const contentInput = document.getElementById('article-content');
                    const dateInput = document.getElementById('article-date');
                    const tagsInput = document.getElementById('article-tags');
                    const imageInput = document.getElementById('article-image');
                    const adminForm = document.getElementById('admin-form');

                    if (!formTitle || !editIdInput || !titleInput || !contentInput || !dateInput || !tagsInput || !imageInput || !adminForm) {
                        throw new Error('One or more form elements are missing.');
                    }

                    formTitle.textContent = 'Modify Article';
                    editIdInput.value = article.id;
                    titleInput.value = article.title;
                    contentInput.value = article.content;
                    dateInput.value = article.date;
                    tagsInput.value = article.tags.join(', ');
                    imageInput.value = article.image;
                    adminForm.classList.add('active');
                    window.scrollTo(0, adminForm.offsetTop);
                    alert('Modify the article and click "Submit Article", then "Export Articles" to update articles.json.');
                }).catch(error => {
                    console.error('Error fetching articles for modify:', error);
                    alert('Failed to load article for modification. Check console for details.');
                });
            } catch (error) {
                console.error('Error in modifyArticle:', error);
                alert(`Failed to modify article: ${error.message}. Check console for details.`);
            }
        }

        function deleteArticle(id) {
            try {
                console.log('deleteArticle called with id:', id);
                const password = prompt('Enter admin password to delete article:');
                if (!password) {
                    alert('Please enter a password.');
                    return;
                }
                if (password !== adminPassword) {
                    alert('Incorrect password.');
                    return;
                }

                let articles;
                try {
                    articles = JSON.parse(localStorage.getItem('articles') || '[]');
                } catch (e) {
                    console.error('Error parsing localStorage articles:', e);
                    articles = [];
                }

                const articleIndex = articles.findIndex(article => article.id === id);
                if (articleIndex === -1) {
                    alert('Article not found in local storage. Syncing with articles.json.');
                    return;
                }

                articles = articles.filter(article => article.id !== id);
                try {
                    localStorage.setItem('articles', JSON.stringify(articles));
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    alert('Failed to save to local storage. Try clearing browser data or using another browser.');
                    return;
                }

                alert('Article deleted locally. Click "Export Articles" to download articles.json, then upload to GitHub.');
                loadArticles();
            } catch (error) {
                console.error('Error in deleteArticle:', error);
                alert(`Failed to delete article: ${error.message}. Check console for details.`);
            }
        }

        async function loadArticles() {
            try {
                console.log('loadArticles called');
                const isAdmin = new URLSearchParams(window.location.search).get('admin') === 'true';
                const articles = await fetchArticles();

                const articleList = document.getElementById('article-list');
                if (!articleList) {
                    throw new Error('Article list element not found.');
                }
                articleList.innerHTML = '';
                const lang = document.getElementById('lang-switcher')?.value || 'mg';

                if (articles.length === 0) {
                    articleList.innerHTML = '<div class="col-span-full text-center text-white text-xl">Mbola tsy misy lahatsoratra. / Aucun article pour le moment. / No articles yet.</div>';
                    return;
                }

                articles.forEach(article => {
                    const articleDiv = document.createElement('div');
                    articleDiv.className = 'glass article-card p-6';
                    const excerpt = article.content.substring(0, 100).replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>');
                    
                    articleDiv.innerHTML = `
                        <div class="article-image mb-4 overflow-hidden">
                            <img src="${article.image}" alt="Article image" class="w-full h-48 object-cover">
                        </div>
                        <h3 class="text-xl font-bold mb-2">
                            <a href
